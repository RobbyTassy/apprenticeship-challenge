<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <script src="http://code.jquery.com/jquery-1.12.0.min.js"></script>
    <title>Kanban app</title>
  </head>
  <body>
    <!-- <div id="app"></div> -->


    <li><a class="add-to-cart" href="#" data-name="Apple" data-price="1.22">Apple $1.22</a></li>
    <li><a class="add-to-cart" href="#" data-name="Banana" data-price="22.33">Banana $1.33</a></li>
    <li><a class="add-to-cart" href="#" data-name="Shoe" data-price="5.22">Shoe $22.33</a></li>
    <li><a class="add-to-cart" href="#" data-name="Frisbee" data-price="5.22">Frisbee $5.22</a></li>
    <button id="clear-cart">Clear Cart</button>


    <div>
      <ul id="show-cart">

      </ul>
      <div>Total Cart: $<span id="total-cart"></span></div>
    </div>


    <script>


      //when user clicks on class, it runs addItemToCart function
      $(".add-to-cart").click(function(event) {
          event.preventDefault(); //Prevents links from doing default behavior, in this case page refreshing
          const name = $(this).attr("data-name"); //this represents link you just clicked on, attr tells it to access an attribute in the a tag
          const price = Number ($(this).attr("data-price")); //Number converts string into integer

          addItemToCart(name, price, 1);
          displayCart();
      });

      $("#clear-cart").click(function(event){
        clearCart();
        displayCart();

      });

      function displayCart() {  //will fill show-cart with each item in cart
        var cartArray = listCart(); //get array from list cart
        var output = ""; //defining what output is before loop so result can be appended with each loop
        for (var i in cartArray) { //loop through existing items in cart
          output += "<li>"+cartArray[i].name+" "+cartArray[i].count+" </li>" //for each existing item,
          // append that particular name and count as a list into output variable which appended inside of #show-cart
        }
        $('#show-cart').html(output);
        $('#total-cart').html( totalCart() );

      }


      // ************************************************************

      // Shopping Cart Functions

      var cart = [];
      var Item = function(name, price, count) {
        this.name = name
        this.price = price
        this.count = count
      };

      function addItemToCart(name, price, count) {
        for (var i in cart) { //loop through each existing (i)tem in cart
          if (cart[i].name === name) { //for each (i)tem in cart, compare to name of users input
              cart[i].count += count; //if names are identical, add users count to existing item's count
              saveCart();
              return; //ends functions
          }
        }
        var item = new Item(name, price, count); //creates users item
        cart.push(item); //add users item to cart
        saveCart();
      }

      //in running addItemToCart test, I learned that count++ would not work because user may specify that
      //he or she may want to add 4 or 5 more apples. With count++, it only ever adds one at a time. 'count += count' adds
      //the amount the user specifies with the existing amount in the cart.


      function removeItemFromCart(name) {
        for (var i in cart) { //loop through each existing item in the cart
          if (cart[i].name === name) { //for each item in cart, compare to name of user's input
            cart[i].count -=1; //if identical, subtract one from exising count in cart
            if (cart[i].count <= 0) { //if the existing count is less or equal to 0,
              cart.splice(i, 1); //remove one item at the array (so it doesn't show at all)
            }
            break; //ends function
          }
        }
        saveCart()
      }


      //in running removeItemFromCart test, I learned that a user could delete so many
      //as to have a negative amount. I tested against this by reassigning any negative values back to 0.


      function removeItemFromCartAll(name) {
        for (var i in cart) { //loop through each existing item in the cart
          if (cart[i].name === name) { //for each item in cart, compare to name of user's input
            cart.splice(i, 1);// if identical, remove the one item at the array
            break;  //ends function
          }
        }
        saveCart();
      }


      function clearCart() {
        cart = [];
        saveCart();
      }


      function countCart() {
        var totalCount = 0;  //setting an initial value of 0...
        for (var i in cart) {//loop through each existing item
          totalCount += cart[i].count; //and add one for each existing item
        }
        return totalCount; //end function
      }


      function totalCart() {
        var totalCost = 0;//starting at 0...
        for (var i in cart) {//loop through each existing item
            totalCost += cart[i].price * cart[i].count;//and add price of exisiting item for each iteration
        }
        return totalCost;
      }


      // Revist 12
      function listCart() {
        var cartCopy = [];
        for (var i in cart) {
          var item = cart[i];
          var itemCopy = {};
          for (var p in item) {
            itemCopy[p] = item[p];
          }
          cartCopy.push(itemCopy);
        }
        return cartCopy;
      }


      // Revisit 12
      // **********************************
      // var array = listCart();
      // array[0].name = "Mistake";
      // console.log( array );



      //JSON converts JS objects and arrays into strings. These strings are saved
      // to the users browsers (local storage) for them to reference if they leave
      // site and return to shop more
      function saveCart() {
        localStorage.setItem("shoppingCart", JSON.stringify(cart));
      }

      // JSON parse reverts the string of data saved on users browsers (local storage)
      // back into JS object and arrays for the functions to read
      function loadCart() {
        cart = JSON.parse(localStorage.getItem("shoppingCart"));
      }

      loadCart();
      displayCart(); //cart must load before you can display, therefore displayCart goes after loadCart

      // clearCart();


    </script>

    <script src="./bundle.js"></script>
  </body>
</html>
